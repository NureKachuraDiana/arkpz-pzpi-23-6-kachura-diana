МІНІСТЕРСТВО ОСВІТИ І НАУКИ УКРАЇНИ

 
ХАРКІВСЬКИЙ НАЦІОНАЛЬНИЙ
УНІВЕРСИТЕТ РАДІОЕЛЕКТРОНІКИ



КАФЕДРА ПІ
  

ЗВІТ
з лабораторної роботи №2
з дисципліни «АНАЛІЗ ТА РЕФАКТОРИНГ 
КОДУ ПРОГРАМНОГО ЗАБЕЗПЕЧЕННЯ»
за темою «РОЗРОБКА БАЗИ ДАНИХ ДЛЯ 
СЕРВЕРНОЇ ЧАСТИНИ ПРОГРАМНОЇ СИСТЕМИ ТА ПРИКЛАДНОГО 
ПРОГРАМНОГО ІНТЕРФЕЙСУ (API)»


Виконала:                                          	             
ст. гр. ПЗПІ-23-6
Качура Діана	Прийняв:	
Асистент кафедри ПІ
Дашенков Д. С.






Харків 2025
2.1 Мета заняття

Розробка бази даних для серверної частини  програмної системи та прикладного програмного інтерфейсу.

2.2 Виконання завдання
2.2.1 Побудова UML – діаграми прецедентів

UML-діаграма прецедентів для серверної частини програмної системи екологічного моніторингу відображає взаємодію зовнішніх користувачів і пристроїв із сервером, а також описує основні операції, що підтримуються системою. Основною метою побудови такої діаграми є визначення функціональних можливостей програмного забезпечення, виділення ролей користувачів та окреслення меж відповідальності між ними. Діаграма демонструє, які саме дії можуть виконувати різні категорії користувачів — неавторизовані користувачі, спостерігачі, оператори та адміністратори, а також IoT-пристрої, що надсилають екологічні дані.
Побудована діаграма (див. рисунок 2.1) дозволяє структурувати вимоги до системи, забезпечує ясність у визначенні функціоналу кожного модуля та полегшує подальшу розробку архітектури серверної частини. Крім того, вона є основою для формування специфікацій API та модулів бізнес-логіки, оскільки показує, які саме сценарії взаємодії повинна підтримувати система.  Роздивемось функціонал користувачів:
1.	IoT-пристрій
IoT-пристрій є зовнішнім автоматичним джерелом даних у системі. Його функціональність обмежується передаванням сирих вимірювань до серверної частини. Пристрій надсилає потоки екологічних показників, які надалі проходять обробку, збереження та використовуються для побудови статистики, графіків, формування сповіщень і контролю стану моніторингових станцій. Він не взаємодіє з інтерфейсом системи та не виконує жодних адміністративних дій — його роль полягає виключно в автоматизованому зборі та передачі даних.

 
Рисунок 2.1 – UML – діаграма прецедентів серверної частини

2.	Неавторизований користувач
Неавторизований користувач має доступ лише до найосновніших можливостей системи. Він може зареєструвати новий обліковий запис, виконати вхід у систему або ініціювати процедуру відновлення пароля. Ця група користувачів не має доступу до внутрішніх даних екологічного моніторингу чи операцій із сенсорами та станціями.
3.	Спостерігач
Спостерігач має розширені можливості у порівнянні з неавторизованим користувачем. Він може працювати з екологічними показниками, отримуючи доступ до перегляду даних моніторингових станцій та історії вимірювань окремих сенсорів. Користувач цього типу здатний створювати власні графіки екологічних показників, оновлювати їх та видаляти за необхідності. Функціональність спостерігача спрямована виключно на отримання інформації.
4.	Авторизований користувач
Авторизований користувач, на відміну від спостерігача, може керувати власним профілем та змінювати персональні налаштування, зокрема мову, формат даних та налаштування сповіщень. Окрім цього, він має змогу переглядати системні події, що стосуються його взаємодії з платформою, та отримувати сповіщення, надіслані системою щодо стану станцій, порогових значень або технічних робіт.
Це роль, яка включає базові персоналізовані можливості, але не дозволяє втручатися у роботу моніторингових станцій або сенсорів.
5.	Оператор
Оператор є центральною роллю для роботи з екологічними даними та обладнанням. Він може здійснювати реєстрацію нових моніторингових станцій, оновлювати їхній стан, переглядати статистику по кожній станції та керувати всіма прикріпленими сенсорами.
Оператор також відповідає за калібрування сенсорів, встановлення порогових значень для автоматичних сповіщень і обслуговування як сенсорів, так і станцій. Йому доступні операції перегляду історії вимірювань, оновлення даних та керування розкладами технічного обслуговування, включаючи редагування та перегляд графіків.
Також оператор може керувати процесами експорту даних, завантажувати сформовані файли та відстежувати статус експортованої інформації. Роль оператора зосереджена на роботі з екологічними показниками та технічним обладнанням.
6.	Адміністратор
Адміністратор має найширший діапазон можливостей і повний контроль над системою. Він може виконувати керування користувачами — створювати, блокувати та розблоковувати облікові записи, переглядати журнали дій користувачів та системні події, що охоплюють усі модулі платформи.
Адміністратор управляє резервними копіями системи, створює їх, завантажує та видаляє застарілі дані. Він також відповідає за глобальне керування експортами даних і може видаляти старі файли експорту.
На відміну від оператора, адміністратор має доступ до загальної статистики по всій системі та може контролювати всі модулі без винятку, включаючи критичні функції, які впливають на роботу всієї інфраструктури моніторингу.

2.2.2 Побудова ER-діаграми даних в нотації «Гусячих лапок»

ER-модель (Entity–Relationship model) є фундаментальним етапом проєктування бази даних та формування логічної структури інформаційної системи. Її побудова дозволяє формально описати предметну область, виділити ключові сутності, визначити їхні атрибути та встановити типи зв’язків між ними. Використання ER-моделювання забезпечує структуровану, послідовну та зрозумілу основу для подальшої розробки реляційної бази даних, сприяє усуненню логічних помилок ще до початку реалізації та допомагає сформувати оптимальну архітектуру зберігання даних.
У контексті розробки системи екологічного моніторингу ER-модель визначає структуру всіх основних елементів системи: моніторингових станцій, сенсорів, екологічних вимірювань, користувачів, сповіщень, статистичних даних, резервних копій, подій та додаткових службових об’єктів. Модель дозволяє описати ієрархію об’єктів, їх поведінку та взаємодію, а також встановлює правила цілісності даних, які забезпечують коректність роботи системи на всіх рівнях.
Побудована ER-діаграма (див. рисунок 2.2) виступає центральним елементом при подальшому створенні логічної та фізичної моделей бази даних, визначає структуру таблиць, ключів, зв’язків «один-до-багатьох» і «багато-до-багатьох», а також слугує основою для опису бізнес-процесів і розробки API серверної частини. 

 
Рисунок 2.2 – ER – діаграма даних

Опишемо кожну сутність БД:
1.	Користувач
Сутність представляє зареєстрованого користувача системи. Містить облікові дані, персональну інформацію, роль у системі, статус активності та часові мітки створення й оновлення. Також пов’язана з сесіями, налаштуваннями, сповіщеннями, журналами активності та іншими системними подіями.
2.	Сесія
Представляє активну або дійсну сесію користувача. Містить токен доступу, час завершення, IP-адресу, тип клієнта та роль, що використовується для авторизації.
3.	Скидання паролю
Зберігає дані для процесу відновлення паролю користувача. Містить одноразовий токен, час дії, інформацію про використання та дату створення.
4.	Налаштування користувача
Містить персональні налаштування користувача: мову інтерфейсу, одиниці вимірювання, параметри темного режиму та варіанти отримання сповіщень (email, push, SMS).
5.	Журнал активності користувача
Фіксує дії користувачів у системі: назву виконаної операції, ресурс, IP-адресу, агент та додаткові метадані. Використовується для аудиту та безпеки.
6.	Дозволи рольової моделі
Визначає права доступу різних ролей до певних ресурсів системи: можливість читання, створення, оновлення та видалення даних.
7.	Моніторингова станція
Представляє фізичну локацію, що здійснює збір екологічних даних. Містить координати, адресу, опис, статус активності та пов’язана з сенсорами, сповіщеннями, агрегованими даними та планами обслуговування.
8.	Сенсор
Вимірювальний пристрій, розміщений на станції. Містить тип сенсора, назву, серійний номер, модель, статус активності, дату калібрування і пов’язаний з вимірюваннями, сирими даними, історією стану та технічним обслуговуванням.
9.	Вимірювання сенсора
Зберігає результати вимірювань: значення, одиницю вимірювання, час фіксації та якість даних. Використовується для аналізу та побудови графіків.
10.	 Сирі дані сенсора
Містить необроблений пакет даних, отриманий від сенсора. Вказує час надходження та статус опрацювання.
11.	 Статус сенсора
Зберігає технічну інформацію про роботу сенсора: онлайн-статус, час останньої перевірки, рівень заряду батареї, силу сигналу та можливі помилки.
12.	 Поріг сповіщення
Описує порогові значення для певного типу сенсора, які використовуються для генерації сповіщень. Містить мінімальні та максимальні значення, рівень критичності та опис.
13.	 Сповіщення станції
Подія, що фіксує перевищення порогових значень. Містить тип сенсора, зафіксоване значення, рівень критичності, опис повідомлення, статус активності та інформацію про підтвердження.
14.	 Агреговані дані
Представляє зведені статистичні показники за заданий проміжок часу: середнє значення, мінімум, максимум, стандартне відхилення та кількість вимірювань. Використовується для побудови графіків і аналітики.
15.	 Сповіщення
Містить повідомлення користувачу: заголовок, текст, тип, пріоритет, статус прочитання та час створення/деактивації.
16.	 Шаблон сповіщення
Зберігає шаблони текстів сповіщень різними мовами. Використовується для автоматичної генерації повідомлень.
17.	 Журнал доставки сповіщень
Фіксує процес відправлення сповіщень: канал доставки, статус, час надсилання, помилки та кількість повторних спроб.
18.	 API-ключ
Представляє ключ доступу до API системи. Містить назву, сам ключ, прив’язку до користувача, статус, дату закінчення та перелік дозволів.
19.	 Журнал API-запитів
Зберігає історію запитів до API: ендпоінт, метод, IP-адресу, статус відповіді, час обробки та тіла запиту/відповіді.
20.	 Експорт даних
Містить інформацію про процес експорту: формат, статус, шлях до файлу, розмір, фільтри, помилки та часові мітки виконання.
21.	 Резервна копія системи
Представляє збереження системних даних для відновлення. Містить назву файлу, шлях, розмір, статус, опис та часові мітки виконання.
22.	 Системна подія
Фіксує події, що відбуваються в системі: тип, джерело, повідомлення, додаткові дані та користувача, який ініціював подію.
23.	 План технічного обслуговування
Визначає графік обслуговування станцій або сенсорів: назву завдання, опис, тип розкладу, дати початку/завершення, відповідального користувача та статус виконання.

2.2.3 Побудова діаграми структури БД

Діаграма структури бази даних (див. рисунок 2.3) є ключовим елементом проєктування інформаційної системи, оскільки вона визначає організацію, взаємозв’язки та правила зберігання даних у реляційній моделі. На відміну від концептуальної ER-моделі, яка описує предметну область на високому рівні абстракції, діаграма структури БД представляє собою детальне технічне подання, що відображає реальні таблиці, поля, типи даних, індекси, зовнішні ключі та обмеження цілісності.
Побудова такої діаграми дозволяє формалізувати логічну структуру даних та забезпечити узгодженість між усіма компонентами системи. Вона слугує основою для створення фізичної моделі, підготовки SQL-скриптів та подальшої реалізації серверної частини. Діаграма структури БД дає змогу чітко визначити, які дані зберігатимуться, у якому вигляді та за якими правилами, що значно зменшує ризики помилок при розробці та оптимізує подальшу підтримку системи.
У контексті системи екологічного моніторингу така діаграма відображає структуру таблиць для станцій, сенсорів, екологічних показників, сповіщень, журналів подій, резервних копій, користувачів та інших службових елементів, з якими працює серверна частина. Її побудова дає змогу сформувати цілісне бачення того, як різні об’єкти системи взаємодіють через базу даних і які залежності між ними впливають на поведінку всієї системи.

 
Рисунок 2.3 – діаграма структури бази даних

Заповнимо таблиці 2.1 – 2.23, де опишемо рядки всіх сутностей БД
Таблиця 2.1 – поля сутності SystemBackup
Поле	Тип	Опис
id	int (PK)	Унікальний ідентифікатор резервної копії системи
fileName	string	Назва файлу резервної копії
filePath	string	Шлях до файлу на сервері
fileSize	float?	Розмір файлу у мегабайтах
status	BackupStatus	Статус резервної копії (PENDING, COMPLETED тощо)
Продовження таблиці 2.1
Поле	Тип	Опис
createdAt	DateTime	Дата та час створення копії
startedAt	DateTime?	Час початку процесу резервування
completedAt	DateTime?	Час завершення процесу
errorMessage	string?	Повідомлення про помилку, якщо резервування не вдалося

Таблиця 2.2 – поля сутності RolePermission
Поле	Тип	Опис
id	int (PK)	Унікальний ідентифікатор запису дозволу
role	Role	Роль, до якої застосовується дозвіл
resource	string	Назва ресурсу/модуля, для якого визначається дозвіл
canRead	boolean	Чи дозволено читання
canWrite	boolean	Чи дозволено створення/редагування
canDelete	boolean	Чи дозволено видалення
createdAt	DateTime	Дата створення
updatedAt	DateTime?	Дата оновлення

Таблиця 2.3 – поля сутності NotificationTemplate
Поле	Тип	Опис
id	int (PK)	Унікальний ідентифікатор запиту на скидання пароля
userId	int (FK)	Ідентифікатор користувача
token	string	Унікальний токен для відновлення
expiresAt	DateTime	Дата та час, коли токен стане недійсним
createdAt	DateTime	Дата створення запиту
usedAt	DateTime?	Час, коли токен був використаний

Таблиця 2.4 – поля сутності PasswordReset
Поле	Тип	Опис
id	int (PK)	Унікальний ідентифікатор запиту на скидання пароля
userId	int (FK)	Ідентифікатор користувача
Продовження таблиці 2.4
Поле	Тип	Опис
token	string	Унікальний токен для відновлення
expiresAt	DateTime	Дата та час, коли токен стане недійсним
createdAt	DateTime	Дата створення запиту
usedAt	DateTime?	Час, коли токен був використаний

Таблиця 2.5 – поля сутності Session
Поле	Тип	Опис
id	int (PK)	Унікальний ідентифікатор сесії
userId	int (FK)	Користувач, якому належить сесія
token	string	JWT токен авторизації
expiresAt	DateTime	Дата і час завершення дії токена
createdAt	DateTime	Дата створення сесії
lastUsedAt	DateTime?	Останній час використання сесії
userAgent	string	Інформація про браузер або клієнт
role	Role	Роль, видана в рамках цієї сесії

Таблиця 2.6 – поля сутності UserPreferences
Поле	Тип	Опис
id	int (PK)	Унікальний ідентифікатор налаштувань
userId	int (FK)	Користувач, якому належать ці налаштування
language	string	Обрана мова інтерфейсу
timezone	string	Часовий пояс користувача
notificationsEnabled	boolean	Чи дозволені сповіщення загалом
emailNotifications	boolean	Чи дозволені email-сповіщення
pushNotifications	boolean	Чи дозволені push-сповіщення
smsNotifications	boolean	Чи дозволені sms-сповіщення
updatedAt	DateTime?	Дата останнього оновлення налаштувань

Таблиця 2.7 – поля сутності SystemEvent
Поле	Тип	Опис
id	int (PK)	Унікальний ідентифікатор системної події
Продовження таблиці 2.7
Поле	Тип	Опис
type	SystemEventType	Тип події (ERROR, INFO, WARNING, MAINTENANCE)
source	string	Джерело події, модуль або сервіс
message	string	Опис події
details	Json?	Додаткова інформація у форматі JSON
userId	int? (FK)	Користувач, який ініціював подію (якщо є)
createdAt	DateTime	Дата та час фіксації події

Таблиця 2.8 – поля сутності NotificationLog
Поле	Тип	Опис
id	int (PK)	Унікальний запис журналу сповіщень
notificationId	int (FK)	Ідентифікатор основного сповіщення
userId	int (FK)	Користувач, якому було відправлено сповіщення
channel	NotificationChannel	Канал доставки (EMAIL, SMS, PUSH, IN_APP)
status	NotificationStatus	Статус надсилання (SENT, FAILED тощо)
sentAt	DateTime	Час відправки
errorMessage	string?	Причина невдачі, якщо статус FAILED
retryCount	int?	Кількість повторних спроб доставки
id	int (PK)	Унікальний запис журналу сповіщень

Таблиця 2.9 – поля сутності SensorStatus
Поле	Тип	Опис
id	int (PK)	Унікальний статус сенсора
sensorId	int (FK)	Сенсор, до якого належить статус
isOnline	boolean	Онлайн/офлайн стан
lastCheck	DateTime	Остання перевірка
battery	float?	Рівень заряду батареї
signal	float?	Рівень сигналу
errors	string?	Активні помилки або стан пристрою
createdAt	DateTime	Час запису статусу
id	int (PK)	Унікальний статус сенсора
Таблиця 2.10 – поля сутності Notification
Поле	Тип	Опис
id	int (PK)	Унікальний ідентифікатор сповіщення
userId	int (FK)	Одержувач
title	string	Заголовок сповіщення
message	string	Текст сповіщення
type	NotificationType	Тип (ALERT, SYSTEM, INFO…)
isRead	boolean	Статус перегляду
priority	AlertSeverity	Пріоритет сповіщення
createdAt	DateTime	Час створення
expiresAt	DateTime?	Час, коли сповіщення стає недійсним

Таблиця 2.11 – поля сутності User
Поле	Тип	Опис
id	int (PK)	Унікальний ідентифікатор користувача
email	string	Електронна пошта
password	string (hash)	Зашифрований пароль
firstName	string	Ім'я користувача
lastName	string	Прізвище
role	Role	Роль у системі (ADMIN/OPERATOR/OBSERVER)
isActive	boolean	Статус активності облікового запису
lastLogin	DateTime?	Останній вхід у систему
createdAt	DateTime	Дата створення облікового запису
updatedAt	DateTime?	Дата оновлення профілю

Таблиця 2.12 – поля сутності UserActivityLog
Поле	Тип	Опис
id	int (PK)	Унікальний ідентифікатор запису журналу активності
userId	int (FK)	Ідентифікатор користувача, який виконав дію
user	User	Зв’язок із користувачем, до якого належить дія
action	string	Назва виконаної дії (наприклад, “LOGIN”, “UPDATE_SETTINGS”)

Продовження таблиці 2.12
Поле	Тип	Опис
resource	string?	Ресурс, над яким здійснювалась дія (сторінка, запис БД тощо)
ipAddress	string?	IP-адреса користувача під час виконання дії
userAgent	string?	Інформація про браузер чи пристрій
metadata	Json?	Додаткова інформація про дію (параметри, контекст)
createdAt	DateTime	Дата та час фіксації дії
resource	string?	Ресурс, над яким здійснювалась дія (сторінка, запис БД тощо)

Таблиця 2.13 – поля сутності MonitoringStation
Поле	Тип	Опис
id	int (PK)	Унікальний ідентифікатор моніторингової станції
name	string	Назва станції
description	string?	Опис або характеристики станції
latitude	float	Географічна широта
longitude	float	Географічна довгота
address	string?	Фізична адреса станції
isActive	boolean	Статус активності станції (чи працює вона зараз)
createdAt	DateTime	Дата створення запису
updatedAt	DateTime	Дата останнього оновлення запису

Таблиця 2.14 – поля сутності Sensor
Поле	Тип	Опис
id	int (PK)	Унікальний ідентифікатор сенсора
stationId	int (FK)	Ідентифікатор станції, до якої прив’язаний сенсор
station	MonitoringStation	Зв’язок із моніторинговою станцією
type	SensorType	Тип сенсора (TEMPERATURE, CO2, HUMIDITY тощо)
name	string	Назва сенсора
serialNumber	string (unique)	Серійний номер сенсора
model	string?	Модель або виробник сенсора
Продовження таблиці 2.14
Поле	Тип	Опис
isActive	boolean	Ознака, чи працює сенсор
calibrationDate	DateTime?	Дата останньої калібровки
createdAt	DateTime	Дата створення запису
updatedAt	DateTime	Дата останнього оновлення

Таблиця 2.15 – поля сутності SensorReading
Поле	Тип	Опис
id	int (PK)	Унікальний ідентифікатор показника сенсора
sensorId	int (FK)	Ідентифікатор сенсора, з якого отримано показник
sensor	Sensor	Зв’язок із сенсором
value	float	Значення вимірюваного параметра
unit	string?	Одиниця вимірювання (°C, %, ppm тощо)
timestamp	DateTime	Час фіксації показника
quality	float?	Показник якості даних (0–1)

Таблиця 2.16 – поля сутності RawSensorData
Поле	Тип	Опис
id	int (PK)	Унікальний ідентифікатор запису
sensorId	int (FK)	Ідентифікатор сенсора
sensor	Sensor	Зв’язок із сенсором, що передав сирі дані
rawPayload	Json	Необроблені дані від сенсора
receivedAt	DateTime	Час отримання даних
processed	boolean	Статус обробки (чи були дані розпарсені та збережені)

Таблиця 2.17 – поля сутності Threshold
Поле	Тип	Опис
id	int (PK)	Унікальний ідентифікатор порогового значення
Продовження таблиці 2.17
Поле	Тип	Опис
sensorType	SensorType	Тип сенсора, до якого застосовується поріг
minValue	float?	Мінімально дозволене значення (опційно)
maxValue	float?	Максимально дозволене значення (опційно)
severity	AlertSeverity	Рівень критичності при порушенні порогу
description	string?	Опис порогового правила
isActive	boolean	Чи є поріг активним
createdAt	DateTime	Дата створення
updatedAt	DateTime	Дата останнього оновлення

Таблиця 2.18 – поля сутності StationAlert
Поле	Тип	Опис
id	int (PK)	Унікальний ідентифікатор тривоги станції
stationId	int (FK)	Ідентифікатор станції, де виникла тривога
sensorId	int? (FK)	Ідентифікатор сенсора, що викликав тривогу (необов’язково)
sensorType	SensorType	Тип сенсора, який згенерував тривогу
value	float	Фактичне значення, що спричинило тривогу
thresholdValue	float	Порогове значення, яке було перевищено
severity	AlertSeverity	Рівень критичності тривоги
message	string	Текст повідомлення
isActive	boolean	Чи є тривога активною
acknowledged	boolean	Чи була тривога підтверджена
acknowledgedBy	int?	Ідентифікатор користувача, який підтвердив
acknowledgedAt	DateTime?	Час підтвердження
createdAt	DateTime	Час створення тривоги
resolvedAt	DateTime?	Час вирішення тривоги




Таблиця 2.19 – поля сутності AggregatedData
Поле	Тип	Опис
id	int (PK)	Унікальний ідентифікатор агрегованого запису
stationId	int (FK)	Ідентифікатор станції
sensorType	SensorType	Тип сенсора, для якого виконано агрегацію
average	float	Середнє значення
minValue	float	Мінімальне значення
maxValue	float	Максимальне значення
stdDev	float?	Стандартне відхилення
count	int	Кількість показників у вибірці
timeRange	string	Діапазон агрегації (наприклад: 1h, 24h, 7d)
startTime	DateTime	Початок періоду
endTime	DateTime	Кінець періоду
createdAt	DateTime	Час створення агрегованого запису

Таблиця 2.20 – поля сутності ApiKey
Поле	Тип	Опис
id	int (PK)	Унікальний ідентифікатор API-ключа
name	string	Назва ключа (для зручності користувача)
key	string (unique)	Сам API-ключ
userId	int (FK)	Користувач, якому належить ключ
isActive	boolean	Чи активний ключ
expiresAt	DateTime?	Дата завершення дії ключа
lastUsedAt	DateTime?	Дата останнього використання
createdAt	DateTime	Дата створення API-ключа
permissions	string[]	Список дозволів/скопів, доступних для ключа

Таблиця 2.21– поля сутності ApiRequestLog
Поле	Тип	Опис
id	int (PK)	Унікальний ідентифікатор запису логів
apiKeyId	int (FK)	Ідентифікатор API-ключа
endpoint	string	Викликаний ендпоінт API
Продовження таблиці 2.21
Поле	Тип	Опис
method	string	HTTP-метод (GET, POST, PUT...)
ipAddress	string?	IP-адреса клієнта
statusCode	int	Статус-код відповіді
responseTime	int?	Час відповіді у мілісекундах
userAgent	string?	Дані про клієнтський агент
requestBody	string?	Тіло запиту (за потреби)
responseBody	string?	Тіло відповіді (за потреби)
createdAt	DateTime	Час виконання запиту

Таблиця 2.22 – поля сутності DataExport
Поле	Тип	Опис
id	int (PK)	Унікальний ідентифікатор експорту даних
userId	int (FK)	Ідентифікатор користувача, який створив експорт
user	User	Зв’язок з користувачем (User)
format	ExportFormat	Формат експорту (наприклад CSV, JSON)
status	ExportStatus	Статус експорту (PENDING, COMPLETED, FAILED)
filePath	string?	Шлях до збереженого файлу експорту
fileName	string?	Згенероване ім’я файлу
fileSize	int?	Розмір файлу в байтах
filters	Json?	Фільтри, застосовані під час експорту
errorMessage	string?	Повідомлення про помилку, якщо експорт не вдався
createdAt	DateTime	Дата та час створення запису
startedAt	DateTime?	Дата та час початку обробки експорту
completedAt	DateTime?	Дата та час завершення експорту

Таблиця 2.23– поля сутності MaintenanceSchedule
Поле	Тип	Опис
id	int (PK)	Унікальний ідентифікатор графіка обслуговування
stationId	int? (FK)	Ідентифікатор станції (за потреби)
Продовження таблиці 2.21
Поле	Тип	Опис
station	MonitoringStation?	Зв’язок зі станцією (MonitoringStation)
sensorId	int? (FK)	Ідентифікатор сенсора (за потреби)
sensor	Sensor?	Зв’язок з сенсором
title	string	Назва завдання на обслуговування
description	string?	Опис завдання
scheduleType	MaintenanceScheduleType	Тип графіка обслуговування (WEEK, MONTH)
startDate	DateTime	Дата початку обслуговування
endDate	DateTime?	Дата завершення обслуговування (за потреби)
isCompleted	Boolean	Статус завершення завдання
assignedTo	int?	Ідентифікатор користувача, відповідального за обслуговування
createdAt	DateTime	Дата та час створення запису
updatedAt	DateTime	Дата та час останнього оновлення запису

2.2.4 Розробка функцій роботи з БД

У цьому проєкті застосовується ORM Prisma у поєднанні з фреймворком NestJS, що разом утворюють потужний та гнучкий інструментарій для реалізації бізнес-логіки, роботи зі складними моделями та підтримки масштабованості системи. Prisma виступає сучасною ORM, яка надає типобезпечний клієнт для взаємодії з базою даних, автоматичне формування моделей на основі схем, генерацію зручних методів запитів і можливість працювати з різними провайдерами БД, зокрема PostgreSQL, що використовується у даному застосунку. 
У контексті NestJS ORM Prisma легко інтегрується через PrismaService, що дозволяє впроваджувати роботу з даними у будь-який модуль застосунку та забезпечує контейнеризованість, ін’єкцію залежностей та високу структурованість коду. Основні методи роботи з даними реалізуються через Prisma Client і охоплюють створення нових сутностей, оновлення існуючих, видалення, пошук за унікальними ключами та складні багатоукладені запити з використанням фільтрів, сортування та відношень між таблицями. Підключення Prisma до бази даних здійснюється у файлі schema.prisma, де визначено генератор клієнта та параметри доступу до БД. Зокрема, налаштування для PostgreSQL виглядає так:
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

Саме ця конфігурація дозволяє Prisma автоматично під’єднатися до бази, створювати клієнтські методи та забезпечувати структуровану роботу з таблицями.
Prisma надає набір зручних і типобезпечних методів для взаємодії з даними, завдяки яким робота з базою набуває інтуїтивності та зрозумілості. Для кожної моделі у Prisma Client автоматично створюється власний набір CRUD-методів. Найпоширенішими є методи читання, зокрема findUnique, який застосовується для пошуку одного конкретного запису за унікальним полем, наприклад первинним ключем; метод findFirst виконує пошук першого запису, що відповідає умовам фільтрації; а findMany дозволяє отримувати одразу кілька записів із підтримкою фільтрів, сортування, пагінації та вибірки пов'язаних даних. Для створення нових записів існує метод create, який приймає об’єкт даних відповідно до схеми та створює новий рядок у таблиці, тоді як createMany дає змогу додавати одразу кілька записів у межах однієї операції. Оновлення даних відбувається через методи update та updateMany: перший змінює конкретний запис, що ідентифікується унікальним полем, другий дозволяє масово оновлювати всі записи, що підходять під умову. Для видалення передбачені методи delete та deleteMany, де delete працює з одним конкретним записом, а deleteMany — з групою записів, які відповідають певному фільтру. 
Крім того, Prisma підтримує виконання транзакцій через prisma.$transaction, дозволяючи об’єднувати кілька операцій у єдиний атомарний блок, а також надає метод prisma.$queryRaw та prisma.$executeRaw для безпосереднього виконання сирих SQL-запитів, коли потрібна максимальна гнучкість. 

2.2.5 Розробка API для взаємодії серверної частини з клієнтами

Розробка API є ключовим етапом створення серверної частини застосунку, оскільки саме через нього клієнтські інтерфейси — веб-додатки, мобільні додатки або сторонні сервіси — отримують доступ до функціоналу системи. Найпоширенішим підходом до організації взаємодії є REST-архітектура, що базується на використанні стандартних HTTP-методів, таких як GET, POST, PUT, DELETE. REST API забезпечує зрозумілу структуру запитів, уніфіковані принципи роботи з ресурсами та простоту інтеграції для будь-якого типу клієнтів. 
Для документування API застосовується Swagger (OpenAPI), який дозволяє автоматично генерувати опис усіх доступних ендпоінтів, їх параметрів, форматів запитів і відповідей. Використання Swagger значно спрощує тестування, інтеграцію та підтримку API.
Метод контроллера виглядає наступним чином:
@Get(':stationId')
    @Roles(Role.OPERATOR)
    @ApiOperation({ summary: 'Get comprehensive statistics for a monitoring station'})
    @ApiParam({ name: 'stationId', description: 'monitoring station ID'})
    @ApiResponse({ status: 200, description: 'Station statistics retrieved successfully'})
    @ApiResponse({ status: 404, description: 'Station not found' })
    async getStationStats(
        @Param('stationId', ParseIntPipe) stationId: number,
        @Req() request: Request,
    ) {
        const token = request.cookies?.session_token;
        return this.monitoringStationStatsService.getStationStats(stationId, token)
    }

Метод @Get(':stationId') описує маршрут, який обробляє GET-запит за адресою /.../123, де 123 — це значення параметра stationId. Декоратор @Roles(Role.OPERATOR) обмежує доступ до цього ресурсу лише користувачами з роллю оператора, що дозволяє контролювати права доступу. За допомогою Swagger-декораторів @ApiOperation, @ApiParam та @ApiResponse виконується документування даного ендпоінта: задається короткий опис його призначення, визначається параметр stationId, а також можливі статус-коди відповіді — успішний (200) або ситуація, коли станцію не знайдено (404). У сигнатурі методу параметр stationId додатково обробляється через ParseIntPipe, що забезпечує автоматичне перетворення значення з рядка у число та валідацію правильності формату даних. Об’єкт request, що надходить у метод, дозволяє отримати необхідну службову інформацію, наприклад токен авторизації з кукі-заголовків (request.cookies?.session_token). Отримані дані передаються у сервісний шар monitoringStationStatsService, який виконує бізнес-логіку та повертає сформовану статистику моніторингової станції.
Повна специфікація розробленого API наведена в додатку А.

2.3 Висновки

У ході виконання лабораторної роботи №2 було спроєктовано та реалізовано повноцінну серверну частину програмної системи разом із базою даних та прикладним програмним інтерфейсом API. Була побудована структура даних, розроблені моделі та налаштована взаємодія з БД через ORM Prisma, що забезпечило типобезпечність, гнучкість і зручність роботи з даними. На основі архітектурного підходу REST реалізовано набір CRUD-операцій для ключових ресурсів системи, завдяки чому сервер став доступним для взаємодії з клієнтськими застосунками та сторонніми сервісами. Виконана робота дозволила сформувати надійну серверну основу, яка може бути розширена та масштабована у майбутньому, забезпечуючи стабільність і логічну завершеність процесів, необхідних для функціонування програмної системи.








ПЕРЕЛІК ДЖЕРЕЛ ПОСИЛАННЯ
1. GitHub - NureKachuraDiana/arkpz-pzpi-23-6-kachura-diana. GitHub. URL:  https://github.com/NureKachuraDiana/arkpz-pzpi-23-6-kachura-diana.
2. YouTube: https://youtu.be/UECsUS_i4F4
 
 Додаток А
Специфікація API

Таблиця А.1 – специфікація API
Ендпоінт	Маршрут	HTTP метод	Доступ	Опис
User
login	/auth/login	POST	Публічний	Авторизація користувача. Повертає дані користувача та встановлює session_token у HTTP-only cookie.
registration	/auth/registration	POST	Публічний	Реєстрація нового користувача. Повертає інформацію про успішну реєстрацію.
logout	/auth/logout	POST	Авторизовані користувачі	Вихід із системи. Видаляє session_token із cookie та завершує сесію користувача.
getCurrentUser	/auth/me	GET	Авторизовані користувачі	Повертає поточного авторизованого користувача на основі session_token.
Backup
createBackup	/backup	POST	Адмін	Створення нового бекапу. Підтримуються типи: database та full.

Продовження таблиці А.1
Ендпоінт	Маршрут	HTTP метод	Доступ	Опис
listBackups	/backup	GET	Адмін	Отримання списку всіх бекапів з підтримкою пагінації та фільтрації за статусом.
getBackup	/backup/:id	GET	Адмін	Отримання деталей бекапу за ID.
downloadBackup	/backup/:id/download	GET	Адмін	Завантаження файлу бекапу за ID.
deleteBackup	/backup/:id	DELETE	Адмін	Видалення бекапу за ID.
cancelBackup	/backup/:id/cancel	POST	Адмін	Скасування бекапу, який знаходиться в процесі створення.
getBackupStats	/backup/stats/summary	GET	Адмін	Отримання статистики по бекапах (зведена інформація).
Data export
createExport	/data-exports	POST	OBSERVER	Створення нового запиту на експорт даних для автентифікованого користувача.
getUserExports	/data-exports	GET	OBSERVER	Отримання пагінованого списку експортів користувача. Параметри: page, limit.

Продовження таблиці А.1
Ендпоінт	Маршрут	HTTP метод	Доступ	Опис
getExportById	/data-exports/:id	GET	OBSERVER	Отримання детальної інформації про експорт за ID.
downloadExport	/data-exports/:id/download	GET	OBSERVER	Завантаження файлу експорту (якщо він готовий).
cancelExport	/data-exports/:id/cancel	POST	OBSERVER	Скасування запиту експорту, якщо він ще в процесі.
deleteExport	/data-exports/:id	DELETE	OBSERVER	Видалення запиту експорту та пов’язаного файлу.
cleanupOldExports	/data-exports/admin/cleanup	POST	ADMIN	Видалення старих експортів за кількістю днів (за замовчуванням — 30).
Maintenance
create	/maintenance-schedules	POST	ADMIN, OPERATOR	Створення нового графіка технічного обслуговування.
findAll	/maintenance-schedules	GET	ADMIN, OPERATOR	Отримання всіх графіків ТО з фільтрами та пагінацією.
getUpcomingForUser	/maintenance-schedules/upcoming/:userId	GET	OPERATOR	Отримання майбутніх робіт для користувача за кількістю днів (default: 7).
findOne	/maintenance-schedules/:id	GET	ADMIN, OPERATOR	Отримання графіка ТО за ID.

Продовження таблиці А.1
Ендпоінт	Маршрут	HTTP метод	Доступ	Опис
update	/maintenance-schedules/:id	PUT	ADMIN, OPERATOR	Оновлення даних графіка ТО.
remove	/maintenance-schedules/:id	DELETE	ADMIN, OPERATOR	Видалення графіка ТО (204 No Content).
assign	/maintenance-schedules/:id/assign	PATCH	OPERATOR	Призначення ТО користувачу.
complete	/maintenance-schedules/:id/complete	PATCH	OPERATOR	Позначення ТО як виконаного.
checkUpcomingMaintenance	/maintenance-schedules/check-upcoming	POST	OPERATOR	Перевірка та надсилання сповіщень про майбутнє ТО.
Monitoring station
create	/monitoring-station	POST	OPERATOR, ADMIN	Створення нової моніторингової станції.
findAll	/monitoring-station	GET	ADMIN	Отримання списку всіх моніторингових станцій.
findOne	/monitoring-station/:id	GET	Публічний	Отримання інформації про конкретну моніторингову станцію за ID.
update	/monitoring-station/:id	PATCH	OPERATOR, ADMIN	Оновлення інформації про моніторингову станцію.
deactivateStation	deactivateStation	deactivateStation	deactivateStation	deactivateStation
remove	/monitoring-station/:id	DELETE	OPERATOR, ADMIN	Видалення моніторингової станції.
activateStation	activateStation	activateStation	activateStation	activateStation
Продовження таблиці А.1
Ендпоінт	Маршрут	HTTP метод	Доступ	Опис
findInRadius	/monitoring-station/radius	GET	OBSERVER	Отримання списку станцій у радіусі заданої точки.
	Monitoring station stats
getStationStats	/monitoring-station-stats/:stationId	GET	OPERATOR	Отримання комплексної статистики моніторингової станції.
getSensorTypeStats	/monitoring-station-stats/:stationId/sensor-type/:sensorType	GET	OPERATOR	Отримання статистики за певним типом сенсора на станції.
getStationHealth	/monitoring-station-stats/health/:stationId	GET	OPERATOR	Отримання інформації про стан здоров'я моніторингової станції (health status).
Notification template
create	/notification-templates	POST	ADMIN	Створення нового шаблону сповіщення.
findAll	/notification-templates	GET	ADMIN	Отримання всіх шаблонів сповіщень.
findOne	/notification-templates/:id	GET	ADMIN	Отримання шаблону за його ID.
update	/notification-templates/:type/:language	PUT	ADMIN	Оновлення шаблону сповіщення за типом та мовою.
remove	/notification-templates/:id	DELETE	ADMIN	Видалення шаблону сповіщення за ID.
Notifications

Продовження таблиці А.1
Ендпоінт	Маршрут	HTTP метод	Доступ	Опис
create	/notifications	POST	Публічний	Створення нового сповіщення.
createFromTemplate	/notifications/from-template	POST	Публічний	Створення сповіщення на основі шаблону. Використовує cookie-сесію або авторизаційний заголовок.
getUserNotifications	/notifications	GET	Авторизований користувач (через session cookie)	Отримання списку сповіщень користувача.
markAsRead	/notifications/read	PATCH	Авторизований користувач	Позначення вибраних сповіщень як прочитаних.
findOne	/notifications/:id	GET	Авторизований користувач	Отримання сповіщення за ID. Користувач може отримати лише власні сповіщення.
Sensor
create	/sensors	POST	OPERATOR	Створення нового сенсора.
findInStation	/sensors/station/:stationId	GET	OPERATOR	Отримання всіх сенсорів певної станції.
getAll	/sensors	GET	ADMIN	Отримання списку всіх сенсорів.
getTypeSensors	/sensors/type/:type	GET	ADMIN	Отримання всіх сенсорів певного типу.
setActive	/sensors/:id/activate	PATCH	ADMIN, OPERATOR	Активувати сенсор.

Продовження таблиці А.1
Ендпоінт	Маршрут	HTTP метод	Доступ	Опис
setInactive	/sensors/:id/deactivate	PATCH	ADMIN, OPERATOR	Деактивувати сенсор.
sensorCalibration	/sensors/:id/calibrate	PUT	OPERATOR	Оновити дату калібрування сенсора (встановити поточну).
getSensorStatus	/sensors/:id/status/latest	GET	OPERATOR	Отримати останній записаний статус сенсора.
getSensorStatusHistory	/sensors/:id/status/history	GET	ADMIN, OPERATOR	Отримати історію всіх статусів сенсора.
findOne	/sensors/:id	GET	ADMIN, OPERATOR	Отримати сенсор за ID.
update	/sensors/:id	PATCH	ADMIN, OPERATOR	Оновити дані сенсора.
remove	/sensors/:id	DELETE	ADMIN, OPERATOR	Видалити сенсор.
Sensor readings
createReading	/sensor-readings	POST	Public	Створити нове показання сенсора.
getReadings	/sensor-readings	GET	Public	Отримати показання сенсорів за вказаний період часу.
getLatestReadings	/sensor-readings/latest	GET	Public	Отримати останні показання для сенсора або станції.
getAggregatedData	/sensor-readings/aggregated	GET	Public	Отримати агреговані дані (сер. знач., мін., макс.) за період та інтервал.
validateDataQuality	/sensor-readings/quality/:serialNumber	GET	Public	Оцінити якість даних для 
Продовження таблиці А.1
Ендпоінт	Маршрут	HTTP метод	Доступ	Опис
				вказаного сенсора за певний період.
processRawData	/sensor-readings/process-raw-data	POST	Public	Обробити необроблені сирі дані сенсорів та конвертувати у структуровані записи.
Settings
get	/settings	GET	Аутентифікований користувач	Отримати налаштування користувача.
update	/settings	PATCH	Аутентифікований користувач	Змінити налаштування користувача.
Station alert
getActiveAlerts	/station-alerts/active	GET	Public	Отримати активні тривоги з фільтрацією та пагінацією.
getAlertHistory	/station-alerts/history	GET	Public	Отримати історію тривог з фільтрацією та пагінацією.
acknowledgeAlert	/station-alerts/:id/acknowledge	PATCH	Аутентифікований користувач	Підтвердити активну тривогу.
clearHistory	/station-alerts/history	DELETE	ADMIN	Очистити історичні тривоги (тільки для адміністраторів).
System
createEvent	/system/events	POST	ADMIN	Створити системну подію.
getAllEvents	/system/events	GET	ADMIN	Отримати всі системні події з фільтрацією.
getEventSummary	/system/events/summary	GET	ADMIN	Отримати зведення системних подій для дашборду.
Продовження таблиці А.1
Ендпоінт	Маршрут	HTTP метод	Доступ	Опис
getEventById	/system/events/:id	GET	ADMIN	Отримати системну подію за ID.
deleteEvent	/system/events/:id	DELETE	ADMIN	Видалити системну подію за ID.
getSystemHealth	/system/health	GET	ADMIN	Отримати статус здоров'я системи.
getSystemStatistics	/system/statistics	GET	ADMIN	Отримати статистику використання системи.
cleanupOldEvents	/system/events/cleanup/old	DELETE	ADMIN	Очистити старі системні події.
getDashboardData	/system/dashboard	GET	ADMIN	Отримати комплексні дані для дашборду.
Threshold
create	/threshold	POST	OPERATOR	Створити новий поріг.
findAll	/threshold	GET	ADMIN	Отримати всі пороги.
findOne	/threshold/:id	GET	ADMIN, OPERATOR	Отримати окремий поріг за ID.
findBySensorType	/threshold/sensor-type/:sensorType	GET	ADMIN	Отримати всі пороги для певного типу сенсора.
update	/threshold/:id	PATCH	ADMIN, OPERATOR	Оновити існуючий поріг.
activate	/threshold/:id/activate	PATCH	ADMIN, OPERATOR	Активувати поріг.
deactivate	/threshold/:id/deactivate	PATCH	ADMIN, OPERATOR	Деактивувати поріг.
remove	/threshold/:id	DELETE	ADMIN, OPERATOR	Видалити поріг за ID.
validateReading	/threshold/validate-reading/:sensorType	POST	ADMIN	Валідувати показання сенсора.

Продовження таблиці А.1
Ендпоінт	Маршрут	HTTP метод	Доступ	Опис
User
findAll	/user	GET	ADMIN	Отримати всіх користувачів.
findOne	/user/:id	GET	ADMIN	Отримати користувача за ID.
remove	/user/:id	DELETE	ADMIN	Видалити користувача за ID.
block	/user/block/:id	PATCH	ADMIN	Заблокувати користувача за ID.
unblock	/user/unblock/:id	PATCH	ADMIN	Розблокувати користувача за ID.
getByEmail	/user/email	GET	ADMIN	Отримати користувача за email.
changeUserRole	/user/role	POST	ADMIN	Змінити роль користувача.
updateProfile	/user/profile	PATCH	Аутентифікований користувач	Змінити дані профілю користувача.
User activity log
create	/user-activity-logs	POST	ADMIN	Створити запис активності користувача.
getAll	/user-activity-logs	GET	ADMIN	Отримати всі записи активності користувачів.
getUserLogs	/user-activity-logs/user/:userId	GET	ADMIN	Отримати записи активності за ID користувача.
getOne	/user-activity-logs/:id	GET	ADMIN	Отримати запис активності за ID.
delete	/user-activity-logs/:id	DELETE	ADMIN	Видалити запис активності за ID.
cleanupOldLogs	/user-activity-logs/cleanup/old	DELETE	ADMIN	Очистити старі записи активності.

